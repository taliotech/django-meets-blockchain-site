{"version":3,"sources":["webpack:///path---part-2-instructions-038db96fbafcedf937bc.js","webpack:///./.cache/json/part-2-instructions.json"],"names":["webpackJsonp","338","module","exports","data","site","siteMetadata","title","sidebarTitle","sidebarSubtext","siteLastUpdated","version","siteUrl","keywords","author","name","url","email","socials","imgpath","sectionList","edges","node","items","id","slug","markdownRemark","html","tableOfContents","excerpt","frontmatter","prev","next","pathContext"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,0BAAAC,aAAA,0BAAAC,eAAA,0BAAAC,gBAAA,2BAAAC,QAAA,MAAAC,QAAA,2DAAAC,SAAA,0BAAAC,QAAuSC,KAAA,WAAAC,IAAA,mBAAAC,MAAA,iBAAmEC,UAAaH,KAAA,UAAAI,QAAA,mBAAAH,IAAA,SAA6DD,KAAA,SAAAI,QAAA,kBAAAH,IAAA,8DAAgHD,KAAA,WAAAI,QAAA,oBAAAH,IAAA,SAA+DD,KAAA,SAAAI,QAAA,kBAAAH,IAAA,WAA4DI,aAAgBC,QAAUC,MAAQf,MAAA,kBAAAgB,QAAoCC,GAAA,eAAAC,KAAA,iCAAAlB,MAAA,iBAAqFiB,GAAA,gBAAAC,KAAA,kCAAAlB,MAAA,qBAA2Fe,MAAQf,MAAA,uBAAAgB,QAAyCC,GAAA,eAAAC,KAAA,oBAAAlB,MAAA,aAAoEiB,GAAA,mBAAAC,KAAA,wBAAAlB,MAAA,oBAAmFe,MAAQf,MAAA,qBAAAgB,QAAuCC,GAAA,sBAAAC,KAAA,oBAAAlB,MAAA,aAA2EiB,GAAA,0BAAAC,KAAA,wBAAAlB,MAAA,qBAA0FmB,gBAAmBC,KAAA;AAAiiwCC,gBAAA,+YAAAC,QAAA,+IAAAC,aAAw7BN,GAAA,0BAAAjB,MAAA,eAAAwB,KAAA,sBAAAC,KAAA,QAAiGC,aAAgBR,KAAA","file":"path---part-2-instructions-038db96fbafcedf937bc.js","sourcesContent":["webpackJsonp([85560507404371],{\n\n/***/ 338:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Django Meets Blockchain\",\"sidebarTitle\":\"Django Meets Blockchain\",\"sidebarSubtext\":\"Django Meets Blockchain\",\"siteLastUpdated\":\"2018-12-04T06:43:57.343Z\",\"version\":\"1.0\",\"siteUrl\":\"https://taliotech.github.io/django-meets-blockchain-site\",\"keywords\":\"talio,blockchain,django\",\"author\":{\"name\":\"Talio.io\",\"url\":\"https://talio.ai\",\"email\":\"info@talio.io\"},\"socials\":[{\"name\":\"Twitter\",\"imgpath\":\"icon-twitter.svg\",\"url\":\"TODO\"},{\"name\":\"GitHub\",\"imgpath\":\"icon-github.svg\",\"url\":\"https://github.com/taliotech/django-meets-blockchain-site\"},{\"name\":\"LinkedIn\",\"imgpath\":\"icon-linkedin.svg\",\"url\":\"TODO\"},{\"name\":\"Medium\",\"imgpath\":\"icon-medium.svg\",\"url\":\"TODO\"}]}},\"sectionList\":{\"edges\":[{\"node\":{\"title\":\"Getting Started\",\"items\":[{\"id\":\"introduction\",\"slug\":\"/getting-started/introduction/\",\"title\":\"Introduction\"},{\"id\":\"prerequisites\",\"slug\":\"/getting-started/prerequisites/\",\"title\":\"Prerequisites\"}]}},{\"node\":{\"title\":\"Part 1: Fundamentals\",\"items\":[{\"id\":\"drf-overview\",\"slug\":\"/part-1/overview/\",\"title\":\"Overview\"},{\"id\":\"drf-instructions\",\"slug\":\"/part-1/instructions/\",\"title\":\"Instructions\"}]}},{\"node\":{\"title\":\"Part 2: Blockchain\",\"items\":[{\"id\":\"blockchain-overview\",\"slug\":\"/part-2/overview/\",\"title\":\"Overview\"},{\"id\":\"blockchain-instructions\",\"slug\":\"/part-2/instructions/\",\"title\":\"Instructions\"}]}}]},\"markdownRemark\":{\"html\":\"<h3 id=\\\"accessing-the-wallet\\\"><a href=\\\"#accessing-the-wallet\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Accessing the Wallet</h3>\\n<p>Before you begin, you’ll need to access your <a href=\\\"https://infura.io\\\">infura.io</a> account — or sign up for one if you didn’t already.</p>\\n<p>In Infura, create a new project. Any name for the project will work; in the example screenshot below, we used <code>COLUMBUSTOKEN</code>.</p>\\n<p>Once you’ve created a project, the first thing you’ll need to do is whitelist the address of the smart contract. The address to use is:</p>\\n<blockquote>\\n<p><code>0x07c344edD719A356775E1FBd852c63Dc46167B76</code></p>\\n</blockquote>\\n<p>Simply add the above to the project whitelist.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; margin-top: 1.5rem; margin-bottom: 1.5rem; max-width: 720px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 54.78018143754362%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQoz42RuUoEQRCG55kEETEQBVNdTMRjwUB8C0ORBTFaUNHdRMHA4zWMBQMT8QjUnRnn6u7p6bl+q1pHFlkWC77porrq76oax1+ZRLg6ZUk3pmHa08DmzFg8qnlZnsAj4a5R/vbcN1uzcMR1D4OLQzyfdeFdHCG5PEF60x9LdHWK8KqHt/MuHrq7eDnu4OlwD2/9AzgSwHsk8ZFIvAYR/CyHopgcg6hh7fbuHgutZSyttzG/2MJOZx+OUQpxJqCUhEoSpFKgMBnK3KA0Y6D7IsugqU5LCSEE1UoS1BncXCBWAsFngCiOUJYl6rq2/LUmPnzPX1PVyIsSjs40UiERBgHSNEVGr9qTuiiKAlEUIY5jSxiGNjYsWFWVjXF3OdU4LJDQqJ7nwfd9C7ev6dIQkhLlz0iMohUx/CifeZ5b0YQmNeT/CrKQ67oYDAY20QpSgtbaFjONPyzK3bEpGteQ73ASX7JoMy6PqckftcNR1uTx7m2HLMCdsSj7Lvky1aiapQ//gBE/pTEr2IzCwnwy5sfn/fBI/4HFeOdf7AUptCVNlpsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"infura-io-screenshot\\\"\\n        title=\\\"\\\"\\n        src=\\\"/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-2cd32.png\\\"\\n        srcset=\\\"/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-a911d.png 180w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-90a67.png 360w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-2cd32.png 720w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-c1214.png 1080w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-4883d.png 1433w\\\"\\n        sizes=\\\"(max-width: 720px) 100vw, 720px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p>Next, create a new file to contain the blockchain logic in the API called <code>core/services.py</code>.</p>\\n<p>At the top of the file, you’ll need a few <code>import</code> statements:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">import</span> json\\n<span class=\\\"token keyword\\\">import</span> os\\n<span class=\\\"token keyword\\\">from</span> web3 <span class=\\\"token keyword\\\">import</span> Web3\\n</code></pre>\\n      </div>\\n<p>Web3.py is the library you’ll be using on both the server and client side to access the API.</p>\\n<p>Next, you’ll need to grab the endpoint URL from your infura.io project page. The URL will have the following form:</p>\\n<blockquote>\\n<p><code>https://mainnet.infura.io/v3/&#x3C;INFURA_PROJECT_ID></code></p>\\n</blockquote>\\n<p><code>&#x3C;INFURA_PROJECT_ID></code> will be specific to your account, so copy the URL from the infura.io project page and declare it as a field in the code, then use that field to instantiate the Web3 class:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Endpoint URL from</span>\\nPROVIDER_ENDPOINT <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"https://mainnet.infura.io/v3/&lt;INFURA_PROJECT_ID>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Instantiate the Web3 class using the custom endpoint</span>\\nweb3 <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">(</span>Web3<span class=\\\"token punctuation\\\">.</span>HTTPProvider<span class=\\\"token punctuation\\\">(</span>PROVIDER_ENDPOINT<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>First, in order to verify configuration and connectivity via Web3, let’s add some simple logic to return a wallet’s balance and expose that as a new endpoint in our API. Continuing in <code>core/services.py</code>, declare a new class, <code>ColumbusTokenService</code>, to wrap the blockchain service logic and add a static method called <code>check_balance</code> that accepts a wallet address as input and returns its balance in ETH as output:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ColumbusTokenService</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token builtin\\\">object</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n\\n    <span class=\\\"token comment\\\"># returns the balance of the wallet in ETH</span>\\n    @<span class=\\\"token builtin\\\">staticmethod</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">check_balance</span><span class=\\\"token punctuation\\\">(</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\"># Get account balance in Wei</span>\\n        wei_balance <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>getBalance<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n\\n        <span class=\\\"token comment\\\"># Convert the account balance from WEI to ETH</span>\\n        eth_balance <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>fromWei<span class=\\\"token punctuation\\\">(</span>wei_balance<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"ether\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"ETH balance: {eth_balance}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n        <span class=\\\"token comment\\\"># return the balance</span>\\n        <span class=\\\"token keyword\\\">return</span> eth_balance\\n</code></pre>\\n      </div>\\n<p>Ethereum measures <strong>ETH</strong> in <strong>WEI</strong>, which is the smallest unit that it’s divisible by. Therefore, 1 ETH is equal to 1,000,000,000,000,000,000 WEI. Similarly, when working with the ColumbusToken, you’ll find that it’s also divisible by 18 places. Web3 provides a helper for converting Wei to a balance denominated in Ether.</p>\\n<blockquote>\\n<p><a href=\\\"http://ethdocs.org/en/latest/ether.html#denominations\\\">Read more about Ether denominations</a></p>\\n</blockquote>\\n<p>Next, add a new endpoint to the <code>WalletViewSet</code> to expose this logic via the API. In <code>core/views.py</code>, start by adding four <code>import</code> statements at the top of the file:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">from</span> rest_framework <span class=\\\"token keyword\\\">import</span> renderers\\n<span class=\\\"token keyword\\\">from</span> rest_framework<span class=\\\"token punctuation\\\">.</span>decorators <span class=\\\"token keyword\\\">import</span> action\\n<span class=\\\"token keyword\\\">from</span> rest_framework<span class=\\\"token punctuation\\\">.</span>response <span class=\\\"token keyword\\\">import</span> Response\\n<span class=\\\"token keyword\\\">from</span> <span class=\\\"token punctuation\\\">.</span>services <span class=\\\"token keyword\\\">import</span> ColumbusTokenService\\n</code></pre>\\n      </div>\\n<p>Then, add a new function <code>def</code> to the end of the <code>WalletViewSet</code> class. The entire class is reproduced below for context; you need to add the block starting with <code>@action</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">WalletViewSet</span><span class=\\\"token punctuation\\\">(</span>viewsets<span class=\\\"token punctuation\\\">.</span>ModelViewSet<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token triple-quoted-string string\\\">\\\"\\\"\\\"\\n    This viewset automatically provides `list`, `create`, `retrieve`,\\n    `update` and `destroy` actions.\\n    \\\"\\\"\\\"</span>\\n    queryset <span class=\\\"token operator\\\">=</span> Wallet<span class=\\\"token punctuation\\\">.</span>objects<span class=\\\"token punctuation\\\">.</span><span class=\\\"token builtin\\\">all</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>order_by<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'id'</span><span class=\\\"token punctuation\\\">)</span>\\n    serializer_class <span class=\\\"token operator\\\">=</span> WalletSerializer\\n\\n    @action<span class=\\\"token punctuation\\\">(</span>detail<span class=\\\"token operator\\\">=</span><span class=\\\"token boolean\\\">True</span><span class=\\\"token punctuation\\\">,</span> renderer_classes<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">[</span>renderers<span class=\\\"token punctuation\\\">.</span>JSONRenderer<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">check_balance</span><span class=\\\"token punctuation\\\">(</span>self<span class=\\\"token punctuation\\\">,</span> request<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">*</span>args<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">**</span>kwargs<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n        wallet <span class=\\\"token operator\\\">=</span> self<span class=\\\"token punctuation\\\">.</span>get_object<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n        balance_eth <span class=\\\"token operator\\\">=</span> ColumbusTokenService<span class=\\\"token punctuation\\\">.</span>check_balance<span class=\\\"token punctuation\\\">(</span>wallet<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">return</span> Response<span class=\\\"token punctuation\\\">(</span>balance_eth<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You should already have an entry for your wallet added to the DB from Part 1; if not, go to <a href=\\\"http://localhost:8000/wallets/\\\">http://localhost:8000/wallets/</a> and use the form to add your wallet with its actual address.</p>\\n<p>Once you have the record, use its numeric ID (<em>not</em> its address) to build a URL that calls the <code>check_balance</code> endpoint. For instance, if the ID assigned to your wallet is <code>1</code>, you’d use the following URL:</p>\\n<blockquote>\\n<p><a href=\\\"http://localhost:8000/wallets/1/check_balance\\\">http://localhost:8000/wallets/1/check_balance</a></p>\\n</blockquote>\\n<p>You should see a small amount returned. The wallet you were provided only has a fractional amount of ETH; that’s ok, as the ColumbusToken only requires a nominal amount.</p>\\n<h3 id=\\\"preparing-the-transaction\\\"><a href=\\\"#preparing-the-transaction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Preparing the Transaction</h3>\\n<p>Now you’ll add a second endpoint with some more complex logic: creating the transaction that will invoke the smart contract to send the ColumbusToken to the wallet. This endpoint will take care of all the logic right up until the transaction needs to be signed and executed.</p>\\n<p>In <code>core/services.py</code>, add a second function after <code>check_balance</code> called <code>prepare_transaction</code>. This function will also take the wallet’s address as input:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">    @<span class=\\\"token builtin\\\">staticmethod</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">prepare_transaction</span><span class=\\\"token punctuation\\\">(</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n</code></pre>\\n      </div>\\n<p>First, declare the address of the deployed ERC-20 contract in the code. This is the same address you whitelisted on infura.io, but in this case, it will need to be converted to a checksum address:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Web3 1.0.0+ requires that we parse the address to a checksum address.</span>\\n      CONTRACT_ADDRESS <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">.</span>toChecksumAddress<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'0x07c344edd719a356775e1fbd852c63dc46167b76'</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You’ll need the JSON for contract’s application binary interface (ABI), which is available at the following URL:</p>\\n<blockquote>\\n<p><a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code\\\">https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code</a></p>\\n</blockquote>\\n<p>Open the above URL in a browser, scroll down to the <strong>Contract ABI</strong> section, then click <strong>Export ABI</strong> and choose <strong>JSON Format</strong>. Save the JSON to <code>core/ColumbusTokenABI.json</code>.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; margin-top: 1.5rem; margin-bottom: 1.5rem; max-width: 720px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 35.47486033519554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz11SN27EQBDT/z9l+BqHM3ClrBwLRShLhQK9HGMOhguCO2HJ0aysbdvQNA2qqsI8z7iuC/u+4zxPHMchZ4Jngnk3inD7vOPt8cDt/oWX9w+8mvg7DGGN44gkSRDHsXCe58KKNE2fYA/rfhAgyzJUdY2iLFEaLOuK3RhaXdchMA2u6yI0Dr7vS+w4jrDnecKskfUcmSn/YxgGWH3fiwin4WUKs8iLMo2pcTrmVIiTap8aMuZwT0E2EXqRImxUdzVVIfbyK/SruIJlWX4FtUBmkbBtW1hzZIqRWVMT5ggaTNMEazXL5AsXRSHLbdtWmLG+/l8mavMYCs1zf/xjfgBa3QCOIDBjNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"etherscan-io-screenshot\\\"\\n        title=\\\"\\\"\\n        src=\\\"/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-2cd32.png\\\"\\n        srcset=\\\"/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-a911d.png 180w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-90a67.png 360w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-2cd32.png 720w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-8f8fa.png 1074w\\\"\\n        sizes=\\\"(max-width: 720px) 100vw, 720px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p>After saving the JSON file, back in the code, load it from the filesystem:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      CONTRACT_ABI <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"\\\"</span>\\n      <span class=\\\"token keyword\\\">with</span> <span class=\\\"token builtin\\\">open</span><span class=\\\"token punctuation\\\">(</span>os<span class=\\\"token punctuation\\\">.</span>path<span class=\\\"token punctuation\\\">.</span>join<span class=\\\"token punctuation\\\">(</span>os<span class=\\\"token punctuation\\\">.</span>path<span class=\\\"token punctuation\\\">.</span>dirname<span class=\\\"token punctuation\\\">(</span>__file__<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'ColumbusTokenABI.json'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">as</span> json_data<span class=\\\"token punctuation\\\">:</span>\\n          abi_json <span class=\\\"token operator\\\">=</span> json<span class=\\\"token punctuation\\\">.</span>load<span class=\\\"token punctuation\\\">(</span>json_data<span class=\\\"token punctuation\\\">)</span>\\n          <span class=\\\"token comment\\\"># The provided abi was taken from etherscan, which has some extra stuff in it.</span>\\n          <span class=\\\"token comment\\\"># We just want the 'result' for creating a contract object.</span>\\n          CONTRACT_ABI <span class=\\\"token operator\\\">=</span> abi_json<span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'result'</span><span class=\\\"token punctuation\\\">]</span>\\n</code></pre>\\n      </div>\\n<p>Now you can instantiate a Web3 <code>Contract</code> object for working with the contract:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      columbusTokenContract <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>contract<span class=\\\"token punctuation\\\">(</span>\\n          address<span class=\\\"token operator\\\">=</span>CONTRACT_ADDRESS<span class=\\\"token punctuation\\\">,</span>\\n          abi<span class=\\\"token operator\\\">=</span>CONTRACT_ABI\\n          <span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Great! Now that we have a contract object we can work with, let’s get some data from the blockchain!</p>\\n<p>Let’s make sure we’re working with the ColumbusToken by making some calls to the contract. The following are “view” functions and can be called for free. All of the readable functions on this contract <a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#readContract\\\">can be found online</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Query the contract name</span>\\n      contract_name <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract Name: {contract_name}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      <span class=\\\"token comment\\\"># Query the contract symbol</span>\\n      contract_symbol <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>symbol<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract Symbol: {contract_symbol}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      <span class=\\\"token comment\\\"># Query the contract's total supply</span>\\n      contract_totalSupply <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>totalSupply<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract totalSupply: {contract_totalSupply}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You can also use the contract to check the token balance on the input account by passing it as a parameter:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Check the CBUS token balance of the account</span>\\n      token_balance <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>balanceOf<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"My CBUS balance: {token_balance}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Functions that only read data from the blockchain can be invoked with the <code>.call()</code> function; functions that will modify the blockchain state will need to be prepared as <strong>transactions</strong>. In order to request a token from the contract and send it to the input wallet, we’ll need a raw transaction.</p>\\n<p>First, you’ll want to set some transaction variables.</p>\\n<p>Declare a <strong>maximum gas</strong> variable to set the maximum amount of gas to be used in the transaction. This generally prevents your costs from unexpectedly getting out of control by killing the transaction when the gas limit is exceeded. For the ColumbusToken, invoking the <code>getToken()</code> method should cost around 69,476 gas, so set a <code>maximum_gas</code> variable using a value that’s just a little more than that.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># 100K should cover the Columbus Token, which only costs 69476 gas</span>\\n      maximum_gas <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">100000</span>\\n</code></pre>\\n      </div>\\n<p>A <strong>nonce</strong> value is required for each transaction. It prevents duplicate transactions from being processed by the network and ensures that transactions are processed in the intended order. The nonce is zero-indexed and should be equal to the number of transactions sent by the account. You can use web3’s <code>getTransactionCount(address)</code> function to get the nonce value for a transaction.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># check the nonce value for the account</span>\\n      nonce <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>getTransactionCount<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"nonce: {nonce}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>The <strong>chain ID</strong> is the ID of the network we are deploying to. Examples of network IDs:</p>\\n<ul>\\n<li>1: Ethereum Mainnet</li>\\n<li>3: Ropsten Testnet</li>\\n<li>4: Rinkeby Testnet</li>\\n</ul>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># The web3 call returns the value as a string, but we will need an integer to create a transaction.</span>\\n      chain_id <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">int</span><span class=\\\"token punctuation\\\">(</span>web3<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token punctuation\\\">.</span>network<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Chain ID: {chain_id}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p><strong>Gas price</strong> is defined programmatically in WEI, but it’s typically discussed in GWEI. Luckily, Web3 provides us a method to quickly convert GWEI to WEI.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      gas_price <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>toWei<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'10'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'gwei'</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Gas Price: {gas_price} wei\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<blockquote>\\n<p>Users may want to check <a href=\\\"https://ethgasstation.info/\\\">https://ethgasstation.info/</a> prior to sending a transaction to ensure that they don’t set too high or low a price.</p>\\n</blockquote>\\n<ul>\\n<li>A gas price that’s too high can incur needless expense.</li>\\n<li>A price that’s too low will mean that your transaction takes longer to process, and if it’s very low it may never get processed at all.</li>\\n</ul>\\n<p>Now you’re ready to build the transaction to request a Columbus Token. First, you’ll need to build a raw transaction containing the data to be transmitted:</p>\\n<blockquote>\\n<p>Reference docs: <a href=\\\"https://web3py.readthedocs.io/en/stable/contracts.html#web3.contract.ContractFunction.buildTransaction\\\">web3.contract.ContractFunction.buildTransaction</a></p>\\n</blockquote>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Build the raw transaction</span>\\n      raw_transaction <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>getToken<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>buildTransaction<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token string\\\">'chainId'</span><span class=\\\"token punctuation\\\">:</span> chain_id<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'gas'</span><span class=\\\"token punctuation\\\">:</span> maximum_gas<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'gasPrice'</span><span class=\\\"token punctuation\\\">:</span> gas_price<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'nonce'</span><span class=\\\"token punctuation\\\">:</span> nonce\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Raw Transaction: {raw_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token comment\\\"># return the transaction JSON</span>\\n      <span class=\\\"token keyword\\\">return</span> raw_transaction\\n</code></pre>\\n      </div>\\n<p>Finally, open up <code>core/views.py</code> again to expose <code>prepare_transaction</code> as a new endpoint in <code>/wallets</code>, just as you did with <code>check_balance</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">  @action<span class=\\\"token punctuation\\\">(</span>detail<span class=\\\"token operator\\\">=</span><span class=\\\"token boolean\\\">True</span><span class=\\\"token punctuation\\\">,</span> renderer_classes<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">[</span>renderers<span class=\\\"token punctuation\\\">.</span>JSONRenderer<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">prepare_transaction</span><span class=\\\"token punctuation\\\">(</span>self<span class=\\\"token punctuation\\\">,</span> request<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">*</span>args<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">**</span>kwargs<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n      wallet <span class=\\\"token operator\\\">=</span> self<span class=\\\"token punctuation\\\">.</span>get_object<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      raw_transaction <span class=\\\"token operator\\\">=</span> ColumbusTokenService<span class=\\\"token punctuation\\\">.</span>prepare_transaction<span class=\\\"token punctuation\\\">(</span>wallet<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">return</span> Response<span class=\\\"token punctuation\\\">(</span>raw_transaction<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Now you should be able to access this endpoint by it’s URL to see the JSON of the raw transaction. Again, if the ID of your wallet in the DB is <code>1</code>, the URL in this case would be:</p>\\n<blockquote>\\n<p><a href=\\\"http://localhost:8000/wallets/1/prepare_transaction\\\">http://localhost:8000/wallets/1/prepare_transaction</a></p>\\n</blockquote>\\n<h3 id=\\\"sign-and-execute-the-transaction\\\"><a href=\\\"#sign-and-execute-the-transaction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Sign and Execute the Transaction</h3>\\n<p>Before the transaction can be executed, it must be signed using the wallet’s private key. As previously discussed, the API won’t have that key, so the raw transaction JSON must be signed on the client side. To do this, you’ll need to make a separate script and execute it outside of the Django server process. For the sake of simplicity, though, you can simply create the script inside the VM so that the same Python stack is available. It will need to interact with the server, though, so be sure to leave the server running.</p>\\n<p>On your <strong>host</strong> machine, open a new terminal window and navigate to the folder where you cloned the django-meets-blockchain repo. From that folder, run the same command you did in part one: <code>vagrant ssh</code>. This will create a second SSH connection to the Vagrant VM, so you should have <strong>two</strong> terminal windows open now — one running the Django server and the other showing the command prompt inside the VM (<code>(dmb-api) vagrant@vagrant:~/dmb-api$</code>).</p>\\n<p>Create a new file in the root repository folder called <code>client.py</code>. You can do this in your text editor or via the terminal. It will appear alongside some of the other Django files like <code>manage.py</code> but we’ll execute it separate from the DRF server. In the real world, this script would be executed on a different machine, but, again, we’re just using the same environment for convenience.</p>\\n<p>The <code>client.py</code> script will also use Web3, so it starts in the same way, with the similar imports and the infura.io endpoint declaration:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">import</span> json\\n<span class=\\\"token keyword\\\">from</span> web3 <span class=\\\"token keyword\\\">import</span> Web3\\n<span class=\\\"token keyword\\\">import</span> urllib3 <span class=\\\"token comment\\\"># used for interacting with the DRF API</span>\\n\\n<span class=\\\"token comment\\\"># Endpoint URL from</span>\\nPROVIDER_ENDPOINT <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"https://mainnet.infura.io/v3/&lt;INFURA_PROJECT_ID>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Instantiate the Web3 class using the custom endpoint</span>\\nweb3 <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">(</span>Web3<span class=\\\"token punctuation\\\">.</span>HTTPProvider<span class=\\\"token punctuation\\\">(</span>PROVIDER_ENDPOINT<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Next, you’ll need to add your private key as a variable. Note <a href=\\\"https://web3py.readthedocs.io/en/stable/web3.eth.account.html\\\">there are many better ways to work with a local private key</a>; declaring it as a field in your code is probably the <em>worst</em> way, but this is a demo script and a demo wallet.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># NOT a good practice,</span>\\nPRIVATE_KEY <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"9bb913343e50eb6b52c64b021baa0413d19963177714931088b1559272b371ff\\\"</span>\\n</code></pre>\\n      </div>\\n<p>First, initialize the account using the private key. The private key can also be used to derive the public address of the wallet.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Use web3.eth.account library to derive the public address from the key.</span>\\n<span class=\\\"token comment\\\">#</span>\\n<span class=\\\"token comment\\\"># https://web3py.readthedocs.io/en/stable/web3.eth.account.html</span>\\nACCOUNT <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>account<span class=\\\"token punctuation\\\">.</span>privateKeyToAccount<span class=\\\"token punctuation\\\">(</span>PRIVATE_KEY<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Wallet address: {ACCOUNT.address}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Next, retrieve the raw transaction JSON from the Django server, which will be running at <code>localhost</code>, using the same URL you used at the end of the last step. You’ll need to initialize the <code>urllib3</code> pool, fetch the JSON, and decode it to use it in the script:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># initialize the urllib3 pool manager</span>\\nhttp <span class=\\\"token operator\\\">=</span> urllib3<span class=\\\"token punctuation\\\">.</span>PoolManager<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\n<span class=\\\"token comment\\\"># get and decode the raw transaction json</span>\\nraw_transaction_json <span class=\\\"token operator\\\">=</span> http<span class=\\\"token punctuation\\\">.</span>request<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'GET'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'http://localhost:8000/wallets/1/prepare_transaction/'</span><span class=\\\"token punctuation\\\">)</span>\\nraw_transaction <span class=\\\"token operator\\\">=</span> json<span class=\\\"token punctuation\\\">.</span>loads<span class=\\\"token punctuation\\\">(</span>raw_transaction_json<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">.</span>decode<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'UTF-8'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Raw Transaction: {raw_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Try running the script from the command line using the new terminal window:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">python client<span class=\\\"token punctuation\\\">.</span>py\\n</code></pre>\\n      </div>\\n<p>You should see the same JSON as at the end of the previous step printed to the console.</p>\\n<p>Next, you’ll need to cryptographically sign the transaction with the account object:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Sign the raw transaction using the private key via the web3 acount object</span>\\nsigned_transaction <span class=\\\"token operator\\\">=</span> ACCOUNT<span class=\\\"token punctuation\\\">.</span>signTransaction<span class=\\\"token punctuation\\\">(</span>raw_transaction<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Signed Transaction: {signed_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<blockquote>\\n<p>The ColumbusToken contract contains a unique (and nonstandard) feature that allows an account to claim one CBUS token once upon request. This can actually be abused pretty easily, so it’s just a fun way to demonstrate interacting with a smart contract. See <a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code\\\">line 57 of the contract’s code</a> to see how this is implemented.</p>\\n</blockquote>\\n<p>Your signed transaction now contains everything it needs to be processed by the network. To get your CBUS Token, add the following line:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">transaction_hash <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>sendRawTransaction<span class=\\\"token punctuation\\\">(</span>signed_transaction<span class=\\\"token punctuation\\\">.</span>rawTransaction<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Transaction Hash: {transaction_hash}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>At this point, running the script again using <code>python client.py</code> will execute the transaction add capture the token to the wallet. Keep in mind you can only do this once — subsequent runs will fail as the ColumbusToken can only be captured once per wallet!</p>\",\"tableOfContents\":\"<ul>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#accessing-the-wallet\\\">Accessing the Wallet</a></li>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#preparing-the-transaction\\\">Preparing the Transaction</a></li>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#sign-and-execute-the-transaction\\\">Sign and Execute the Transaction</a></li>\\n</ul>\",\"excerpt\":\"Accessing the Wallet Before you begin, you’ll need to access your  infura.io  account — or sign up for one if you didn’t already. In Infura…\",\"frontmatter\":{\"id\":\"blockchain-instructions\",\"title\":\"Instructions\",\"prev\":\"blockchain-overview\",\"next\":null}}},\"pathContext\":{\"slug\":\"/part-2/instructions/\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---part-2-instructions-038db96fbafcedf937bc.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"Django Meets Blockchain\",\"sidebarTitle\":\"Django Meets Blockchain\",\"sidebarSubtext\":\"Django Meets Blockchain\",\"siteLastUpdated\":\"2018-12-04T06:43:57.343Z\",\"version\":\"1.0\",\"siteUrl\":\"https://taliotech.github.io/django-meets-blockchain-site\",\"keywords\":\"talio,blockchain,django\",\"author\":{\"name\":\"Talio.io\",\"url\":\"https://talio.ai\",\"email\":\"info@talio.io\"},\"socials\":[{\"name\":\"Twitter\",\"imgpath\":\"icon-twitter.svg\",\"url\":\"TODO\"},{\"name\":\"GitHub\",\"imgpath\":\"icon-github.svg\",\"url\":\"https://github.com/taliotech/django-meets-blockchain-site\"},{\"name\":\"LinkedIn\",\"imgpath\":\"icon-linkedin.svg\",\"url\":\"TODO\"},{\"name\":\"Medium\",\"imgpath\":\"icon-medium.svg\",\"url\":\"TODO\"}]}},\"sectionList\":{\"edges\":[{\"node\":{\"title\":\"Getting Started\",\"items\":[{\"id\":\"introduction\",\"slug\":\"/getting-started/introduction/\",\"title\":\"Introduction\"},{\"id\":\"prerequisites\",\"slug\":\"/getting-started/prerequisites/\",\"title\":\"Prerequisites\"}]}},{\"node\":{\"title\":\"Part 1: Fundamentals\",\"items\":[{\"id\":\"drf-overview\",\"slug\":\"/part-1/overview/\",\"title\":\"Overview\"},{\"id\":\"drf-instructions\",\"slug\":\"/part-1/instructions/\",\"title\":\"Instructions\"}]}},{\"node\":{\"title\":\"Part 2: Blockchain\",\"items\":[{\"id\":\"blockchain-overview\",\"slug\":\"/part-2/overview/\",\"title\":\"Overview\"},{\"id\":\"blockchain-instructions\",\"slug\":\"/part-2/instructions/\",\"title\":\"Instructions\"}]}}]},\"markdownRemark\":{\"html\":\"<h3 id=\\\"accessing-the-wallet\\\"><a href=\\\"#accessing-the-wallet\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Accessing the Wallet</h3>\\n<p>Before you begin, you’ll need to access your <a href=\\\"https://infura.io\\\">infura.io</a> account — or sign up for one if you didn’t already.</p>\\n<p>In Infura, create a new project. Any name for the project will work; in the example screenshot below, we used <code>COLUMBUSTOKEN</code>.</p>\\n<p>Once you’ve created a project, the first thing you’ll need to do is whitelist the address of the smart contract. The address to use is:</p>\\n<blockquote>\\n<p><code>0x07c344edD719A356775E1FBd852c63Dc46167B76</code></p>\\n</blockquote>\\n<p>Simply add the above to the project whitelist.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; margin-top: 1.5rem; margin-bottom: 1.5rem; max-width: 720px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 54.78018143754362%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQoz42RuUoEQRCG55kEETEQBVNdTMRjwUB8C0ORBTFaUNHdRMHA4zWMBQMT8QjUnRnn6u7p6bl+q1pHFlkWC77porrq76oax1+ZRLg6ZUk3pmHa08DmzFg8qnlZnsAj4a5R/vbcN1uzcMR1D4OLQzyfdeFdHCG5PEF60x9LdHWK8KqHt/MuHrq7eDnu4OlwD2/9AzgSwHsk8ZFIvAYR/CyHopgcg6hh7fbuHgutZSyttzG/2MJOZx+OUQpxJqCUhEoSpFKgMBnK3KA0Y6D7IsugqU5LCSEE1UoS1BncXCBWAsFngCiOUJYl6rq2/LUmPnzPX1PVyIsSjs40UiERBgHSNEVGr9qTuiiKAlEUIY5jSxiGNjYsWFWVjXF3OdU4LJDQqJ7nwfd9C7ev6dIQkhLlz0iMohUx/CifeZ5b0YQmNeT/CrKQ67oYDAY20QpSgtbaFjONPyzK3bEpGteQ73ASX7JoMy6PqckftcNR1uTx7m2HLMCdsSj7Lvky1aiapQ//gBE/pTEr2IzCwnwy5sfn/fBI/4HFeOdf7AUptCVNlpsAAAAASUVORK5CYII='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"infura-io-screenshot\\\"\\n        title=\\\"\\\"\\n        src=\\\"/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-2cd32.png\\\"\\n        srcset=\\\"/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-a911d.png 180w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-90a67.png 360w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-2cd32.png 720w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-c1214.png 1080w,\\n/django-meets-blockchain-site/static/infura-230042179ea61e174a220c9ce0dcb42e-4883d.png 1433w\\\"\\n        sizes=\\\"(max-width: 720px) 100vw, 720px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p>Next, create a new file to contain the blockchain logic in the API called <code>core/services.py</code>.</p>\\n<p>At the top of the file, you’ll need a few <code>import</code> statements:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">import</span> json\\n<span class=\\\"token keyword\\\">import</span> os\\n<span class=\\\"token keyword\\\">from</span> web3 <span class=\\\"token keyword\\\">import</span> Web3\\n</code></pre>\\n      </div>\\n<p>Web3.py is the library you’ll be using on both the server and client side to access the API.</p>\\n<p>Next, you’ll need to grab the endpoint URL from your infura.io project page. The URL will have the following form:</p>\\n<blockquote>\\n<p><code>https://mainnet.infura.io/v3/&#x3C;INFURA_PROJECT_ID></code></p>\\n</blockquote>\\n<p><code>&#x3C;INFURA_PROJECT_ID></code> will be specific to your account, so copy the URL from the infura.io project page and declare it as a field in the code, then use that field to instantiate the Web3 class:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Endpoint URL from</span>\\nPROVIDER_ENDPOINT <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"https://mainnet.infura.io/v3/&lt;INFURA_PROJECT_ID>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Instantiate the Web3 class using the custom endpoint</span>\\nweb3 <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">(</span>Web3<span class=\\\"token punctuation\\\">.</span>HTTPProvider<span class=\\\"token punctuation\\\">(</span>PROVIDER_ENDPOINT<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>First, in order to verify configuration and connectivity via Web3, let’s add some simple logic to return a wallet’s balance and expose that as a new endpoint in our API. Continuing in <code>core/services.py</code>, declare a new class, <code>ColumbusTokenService</code>, to wrap the blockchain service logic and add a static method called <code>check_balance</code> that accepts a wallet address as input and returns its balance in ETH as output:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">ColumbusTokenService</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token builtin\\\">object</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n\\n    <span class=\\\"token comment\\\"># returns the balance of the wallet in ETH</span>\\n    @<span class=\\\"token builtin\\\">staticmethod</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">check_balance</span><span class=\\\"token punctuation\\\">(</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\"># Get account balance in Wei</span>\\n        wei_balance <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>getBalance<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n\\n        <span class=\\\"token comment\\\"># Convert the account balance from WEI to ETH</span>\\n        eth_balance <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>fromWei<span class=\\\"token punctuation\\\">(</span>wei_balance<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">\\\"ether\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"ETH balance: {eth_balance}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n        <span class=\\\"token comment\\\"># return the balance</span>\\n        <span class=\\\"token keyword\\\">return</span> eth_balance\\n</code></pre>\\n      </div>\\n<p>Ethereum measures <strong>ETH</strong> in <strong>WEI</strong>, which is the smallest unit that it’s divisible by. Therefore, 1 ETH is equal to 1,000,000,000,000,000,000 WEI. Similarly, when working with the ColumbusToken, you’ll find that it’s also divisible by 18 places. Web3 provides a helper for converting Wei to a balance denominated in Ether.</p>\\n<blockquote>\\n<p><a href=\\\"http://ethdocs.org/en/latest/ether.html#denominations\\\">Read more about Ether denominations</a></p>\\n</blockquote>\\n<p>Next, add a new endpoint to the <code>WalletViewSet</code> to expose this logic via the API. In <code>core/views.py</code>, start by adding four <code>import</code> statements at the top of the file:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">from</span> rest_framework <span class=\\\"token keyword\\\">import</span> renderers\\n<span class=\\\"token keyword\\\">from</span> rest_framework<span class=\\\"token punctuation\\\">.</span>decorators <span class=\\\"token keyword\\\">import</span> action\\n<span class=\\\"token keyword\\\">from</span> rest_framework<span class=\\\"token punctuation\\\">.</span>response <span class=\\\"token keyword\\\">import</span> Response\\n<span class=\\\"token keyword\\\">from</span> <span class=\\\"token punctuation\\\">.</span>services <span class=\\\"token keyword\\\">import</span> ColumbusTokenService\\n</code></pre>\\n      </div>\\n<p>Then, add a new function <code>def</code> to the end of the <code>WalletViewSet</code> class. The entire class is reproduced below for context; you need to add the block starting with <code>@action</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">WalletViewSet</span><span class=\\\"token punctuation\\\">(</span>viewsets<span class=\\\"token punctuation\\\">.</span>ModelViewSet<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token triple-quoted-string string\\\">\\\"\\\"\\\"\\n    This viewset automatically provides `list`, `create`, `retrieve`,\\n    `update` and `destroy` actions.\\n    \\\"\\\"\\\"</span>\\n    queryset <span class=\\\"token operator\\\">=</span> Wallet<span class=\\\"token punctuation\\\">.</span>objects<span class=\\\"token punctuation\\\">.</span><span class=\\\"token builtin\\\">all</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>order_by<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'id'</span><span class=\\\"token punctuation\\\">)</span>\\n    serializer_class <span class=\\\"token operator\\\">=</span> WalletSerializer\\n\\n    @action<span class=\\\"token punctuation\\\">(</span>detail<span class=\\\"token operator\\\">=</span><span class=\\\"token boolean\\\">True</span><span class=\\\"token punctuation\\\">,</span> renderer_classes<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">[</span>renderers<span class=\\\"token punctuation\\\">.</span>JSONRenderer<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">check_balance</span><span class=\\\"token punctuation\\\">(</span>self<span class=\\\"token punctuation\\\">,</span> request<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">*</span>args<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">**</span>kwargs<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n        wallet <span class=\\\"token operator\\\">=</span> self<span class=\\\"token punctuation\\\">.</span>get_object<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n        balance_eth <span class=\\\"token operator\\\">=</span> ColumbusTokenService<span class=\\\"token punctuation\\\">.</span>check_balance<span class=\\\"token punctuation\\\">(</span>wallet<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">return</span> Response<span class=\\\"token punctuation\\\">(</span>balance_eth<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You should already have an entry for your wallet added to the DB from Part 1; if not, go to <a href=\\\"http://localhost:8000/wallets/\\\">http://localhost:8000/wallets/</a> and use the form to add your wallet with its actual address.</p>\\n<p>Once you have the record, use its numeric ID (<em>not</em> its address) to build a URL that calls the <code>check_balance</code> endpoint. For instance, if the ID assigned to your wallet is <code>1</code>, you’d use the following URL:</p>\\n<blockquote>\\n<p><a href=\\\"http://localhost:8000/wallets/1/check_balance\\\">http://localhost:8000/wallets/1/check_balance</a></p>\\n</blockquote>\\n<p>You should see a small amount returned. The wallet you were provided only has a fractional amount of ETH; that’s ok, as the ColumbusToken only requires a nominal amount.</p>\\n<h3 id=\\\"preparing-the-transaction\\\"><a href=\\\"#preparing-the-transaction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Preparing the Transaction</h3>\\n<p>Now you’ll add a second endpoint with some more complex logic: creating the transaction that will invoke the smart contract to send the ColumbusToken to the wallet. This endpoint will take care of all the logic right up until the transaction needs to be signed and executed.</p>\\n<p>In <code>core/services.py</code>, add a second function after <code>check_balance</code> called <code>prepare_transaction</code>. This function will also take the wallet’s address as input:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">    @<span class=\\\"token builtin\\\">staticmethod</span>\\n    <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">prepare_transaction</span><span class=\\\"token punctuation\\\">(</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n</code></pre>\\n      </div>\\n<p>First, declare the address of the deployed ERC-20 contract in the code. This is the same address you whitelisted on infura.io, but in this case, it will need to be converted to a checksum address:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Web3 1.0.0+ requires that we parse the address to a checksum address.</span>\\n      CONTRACT_ADDRESS <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">.</span>toChecksumAddress<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'0x07c344edd719a356775e1fbd852c63dc46167b76'</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You’ll need the JSON for contract’s application binary interface (ABI), which is available at the following URL:</p>\\n<blockquote>\\n<p><a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code\\\">https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code</a></p>\\n</blockquote>\\n<p>Open the above URL in a browser, scroll down to the <strong>Contract ABI</strong> section, then click <strong>Export ABI</strong> and choose <strong>JSON Format</strong>. Save the JSON to <code>core/ColumbusTokenABI.json</code>.</p>\\n<p>\\n  <span\\n    class=\\\"gatsby-resp-image-wrapper\\\"\\n    style=\\\"position: relative; display: block; margin-top: 1.5rem; margin-bottom: 1.5rem; max-width: 720px; margin-left: auto; margin-right: auto;\\\"\\n  >\\n    <span\\n      class=\\\"gatsby-resp-image-background-image\\\"\\n      style=\\\"padding-bottom: 35.47486033519554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz11SN27EQBDT/z9l+BqHM3ClrBwLRShLhQK9HGMOhguCO2HJ0aysbdvQNA2qqsI8z7iuC/u+4zxPHMchZ4Jngnk3inD7vOPt8cDt/oWX9w+8mvg7DGGN44gkSRDHsXCe58KKNE2fYA/rfhAgyzJUdY2iLFEaLOuK3RhaXdchMA2u6yI0Dr7vS+w4jrDnecKskfUcmSn/YxgGWH3fiwin4WUKs8iLMo2pcTrmVIiTap8aMuZwT0E2EXqRImxUdzVVIfbyK/SruIJlWX4FtUBmkbBtW1hzZIqRWVMT5ggaTNMEazXL5AsXRSHLbdtWmLG+/l8mavMYCs1zf/xjfgBa3QCOIDBjNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\\"\\n    >\\n      <img\\n        class=\\\"gatsby-resp-image-image\\\"\\n        style=\\\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\\\"\\n        alt=\\\"etherscan-io-screenshot\\\"\\n        title=\\\"\\\"\\n        src=\\\"/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-2cd32.png\\\"\\n        srcset=\\\"/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-a911d.png 180w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-90a67.png 360w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-2cd32.png 720w,\\n/django-meets-blockchain-site/static/etherscan-88f1f6eb76868739e7d21abe4a3ecd66-8f8fa.png 1074w\\\"\\n        sizes=\\\"(max-width: 720px) 100vw, 720px\\\"\\n      />\\n    </span>\\n  </span>\\n  </p>\\n<p>After saving the JSON file, back in the code, load it from the filesystem:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      CONTRACT_ABI <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"\\\"</span>\\n      <span class=\\\"token keyword\\\">with</span> <span class=\\\"token builtin\\\">open</span><span class=\\\"token punctuation\\\">(</span>os<span class=\\\"token punctuation\\\">.</span>path<span class=\\\"token punctuation\\\">.</span>join<span class=\\\"token punctuation\\\">(</span>os<span class=\\\"token punctuation\\\">.</span>path<span class=\\\"token punctuation\\\">.</span>dirname<span class=\\\"token punctuation\\\">(</span>__file__<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'ColumbusTokenABI.json'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token keyword\\\">as</span> json_data<span class=\\\"token punctuation\\\">:</span>\\n          abi_json <span class=\\\"token operator\\\">=</span> json<span class=\\\"token punctuation\\\">.</span>load<span class=\\\"token punctuation\\\">(</span>json_data<span class=\\\"token punctuation\\\">)</span>\\n          <span class=\\\"token comment\\\"># The provided abi was taken from etherscan, which has some extra stuff in it.</span>\\n          <span class=\\\"token comment\\\"># We just want the 'result' for creating a contract object.</span>\\n          CONTRACT_ABI <span class=\\\"token operator\\\">=</span> abi_json<span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'result'</span><span class=\\\"token punctuation\\\">]</span>\\n</code></pre>\\n      </div>\\n<p>Now you can instantiate a Web3 <code>Contract</code> object for working with the contract:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      columbusTokenContract <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>contract<span class=\\\"token punctuation\\\">(</span>\\n          address<span class=\\\"token operator\\\">=</span>CONTRACT_ADDRESS<span class=\\\"token punctuation\\\">,</span>\\n          abi<span class=\\\"token operator\\\">=</span>CONTRACT_ABI\\n          <span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Great! Now that we have a contract object we can work with, let’s get some data from the blockchain!</p>\\n<p>Let’s make sure we’re working with the ColumbusToken by making some calls to the contract. The following are “view” functions and can be called for free. All of the readable functions on this contract <a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#readContract\\\">can be found online</a>.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Query the contract name</span>\\n      contract_name <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>name<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract Name: {contract_name}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      <span class=\\\"token comment\\\"># Query the contract symbol</span>\\n      contract_symbol <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>symbol<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract Symbol: {contract_symbol}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n\\n      <span class=\\\"token comment\\\"># Query the contract's total supply</span>\\n      contract_totalSupply <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>totalSupply<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Contract totalSupply: {contract_totalSupply}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>You can also use the contract to check the token balance on the input account by passing it as a parameter:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Check the CBUS token balance of the account</span>\\n      token_balance <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>balanceOf<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>call<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"My CBUS balance: {token_balance}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Functions that only read data from the blockchain can be invoked with the <code>.call()</code> function; functions that will modify the blockchain state will need to be prepared as <strong>transactions</strong>. In order to request a token from the contract and send it to the input wallet, we’ll need a raw transaction.</p>\\n<p>First, you’ll want to set some transaction variables.</p>\\n<p>Declare a <strong>maximum gas</strong> variable to set the maximum amount of gas to be used in the transaction. This generally prevents your costs from unexpectedly getting out of control by killing the transaction when the gas limit is exceeded. For the ColumbusToken, invoking the <code>getToken()</code> method should cost around 69,476 gas, so set a <code>maximum_gas</code> variable using a value that’s just a little more than that.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># 100K should cover the Columbus Token, which only costs 69476 gas</span>\\n      maximum_gas <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">100000</span>\\n</code></pre>\\n      </div>\\n<p>A <strong>nonce</strong> value is required for each transaction. It prevents duplicate transactions from being processed by the network and ensures that transactions are processed in the intended order. The nonce is zero-indexed and should be equal to the number of transactions sent by the account. You can use web3’s <code>getTransactionCount(address)</code> function to get the nonce value for a transaction.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># check the nonce value for the account</span>\\n      nonce <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>getTransactionCount<span class=\\\"token punctuation\\\">(</span>ACCOUNT<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"nonce: {nonce}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>The <strong>chain ID</strong> is the ID of the network we are deploying to. Examples of network IDs:</p>\\n<ul>\\n<li>1: Ethereum Mainnet</li>\\n<li>3: Ropsten Testnet</li>\\n<li>4: Rinkeby Testnet</li>\\n</ul>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># The web3 call returns the value as a string, but we will need an integer to create a transaction.</span>\\n      chain_id <span class=\\\"token operator\\\">=</span> <span class=\\\"token builtin\\\">int</span><span class=\\\"token punctuation\\\">(</span>web3<span class=\\\"token punctuation\\\">.</span>version<span class=\\\"token punctuation\\\">.</span>network<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Chain ID: {chain_id}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p><strong>Gas price</strong> is defined programmatically in WEI, but it’s typically discussed in GWEI. Luckily, Web3 provides us a method to quickly convert GWEI to WEI.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      gas_price <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>toWei<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'10'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'gwei'</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Gas Price: {gas_price} wei\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<blockquote>\\n<p>Users may want to check <a href=\\\"https://ethgasstation.info/\\\">https://ethgasstation.info/</a> prior to sending a transaction to ensure that they don’t set too high or low a price.</p>\\n</blockquote>\\n<ul>\\n<li>A gas price that’s too high can incur needless expense.</li>\\n<li>A price that’s too low will mean that your transaction takes longer to process, and if it’s very low it may never get processed at all.</li>\\n</ul>\\n<p>Now you’re ready to build the transaction to request a Columbus Token. First, you’ll need to build a raw transaction containing the data to be transmitted:</p>\\n<blockquote>\\n<p>Reference docs: <a href=\\\"https://web3py.readthedocs.io/en/stable/contracts.html#web3.contract.ContractFunction.buildTransaction\\\">web3.contract.ContractFunction.buildTransaction</a></p>\\n</blockquote>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">      <span class=\\\"token comment\\\"># Build the raw transaction</span>\\n      raw_transaction <span class=\\\"token operator\\\">=</span> columbusTokenContract<span class=\\\"token punctuation\\\">.</span>functions<span class=\\\"token punctuation\\\">.</span>getToken<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">.</span>buildTransaction<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token string\\\">'chainId'</span><span class=\\\"token punctuation\\\">:</span> chain_id<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'gas'</span><span class=\\\"token punctuation\\\">:</span> maximum_gas<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'gasPrice'</span><span class=\\\"token punctuation\\\">:</span> gas_price<span class=\\\"token punctuation\\\">,</span>\\n          <span class=\\\"token string\\\">'nonce'</span><span class=\\\"token punctuation\\\">:</span> nonce\\n      <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Raw Transaction: {raw_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token comment\\\"># return the transaction JSON</span>\\n      <span class=\\\"token keyword\\\">return</span> raw_transaction\\n</code></pre>\\n      </div>\\n<p>Finally, open up <code>core/views.py</code> again to expose <code>prepare_transaction</code> as a new endpoint in <code>/wallets</code>, just as you did with <code>check_balance</code>:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">  @action<span class=\\\"token punctuation\\\">(</span>detail<span class=\\\"token operator\\\">=</span><span class=\\\"token boolean\\\">True</span><span class=\\\"token punctuation\\\">,</span> renderer_classes<span class=\\\"token operator\\\">=</span><span class=\\\"token punctuation\\\">[</span>renderers<span class=\\\"token punctuation\\\">.</span>JSONRenderer<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token keyword\\\">def</span> <span class=\\\"token function\\\">prepare_transaction</span><span class=\\\"token punctuation\\\">(</span>self<span class=\\\"token punctuation\\\">,</span> request<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">*</span>args<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">**</span>kwargs<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">:</span>\\n      wallet <span class=\\\"token operator\\\">=</span> self<span class=\\\"token punctuation\\\">.</span>get_object<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n      raw_transaction <span class=\\\"token operator\\\">=</span> ColumbusTokenService<span class=\\\"token punctuation\\\">.</span>prepare_transaction<span class=\\\"token punctuation\\\">(</span>wallet<span class=\\\"token punctuation\\\">.</span>address<span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">return</span> Response<span class=\\\"token punctuation\\\">(</span>raw_transaction<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Now you should be able to access this endpoint by it’s URL to see the JSON of the raw transaction. Again, if the ID of your wallet in the DB is <code>1</code>, the URL in this case would be:</p>\\n<blockquote>\\n<p><a href=\\\"http://localhost:8000/wallets/1/prepare_transaction\\\">http://localhost:8000/wallets/1/prepare_transaction</a></p>\\n</blockquote>\\n<h3 id=\\\"sign-and-execute-the-transaction\\\"><a href=\\\"#sign-and-execute-the-transaction\\\" aria-hidden=\\\"true\\\" class=\\\"anchor\\\"><svg aria-hidden=\\\"true\\\" height=\\\"16\\\" version=\\\"1.1\\\" viewBox=\\\"0 0 16 16\\\" width=\\\"16\\\"><path fill-rule=\\\"evenodd\\\" d=\\\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\\\"></path></svg></a>Sign and Execute the Transaction</h3>\\n<p>Before the transaction can be executed, it must be signed using the wallet’s private key. As previously discussed, the API won’t have that key, so the raw transaction JSON must be signed on the client side. To do this, you’ll need to make a separate script and execute it outside of the Django server process. For the sake of simplicity, though, you can simply create the script inside the VM so that the same Python stack is available. It will need to interact with the server, though, so be sure to leave the server running.</p>\\n<p>On your <strong>host</strong> machine, open a new terminal window and navigate to the folder where you cloned the django-meets-blockchain repo. From that folder, run the same command you did in part one: <code>vagrant ssh</code>. This will create a second SSH connection to the Vagrant VM, so you should have <strong>two</strong> terminal windows open now — one running the Django server and the other showing the command prompt inside the VM (<code>(dmb-api) vagrant@vagrant:~/dmb-api$</code>).</p>\\n<p>Create a new file in the root repository folder called <code>client.py</code>. You can do this in your text editor or via the terminal. It will appear alongside some of the other Django files like <code>manage.py</code> but we’ll execute it separate from the DRF server. In the real world, this script would be executed on a different machine, but, again, we’re just using the same environment for convenience.</p>\\n<p>The <code>client.py</code> script will also use Web3, so it starts in the same way, with the similar imports and the infura.io endpoint declaration:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token keyword\\\">import</span> json\\n<span class=\\\"token keyword\\\">from</span> web3 <span class=\\\"token keyword\\\">import</span> Web3\\n<span class=\\\"token keyword\\\">import</span> urllib3 <span class=\\\"token comment\\\"># used for interacting with the DRF API</span>\\n\\n<span class=\\\"token comment\\\"># Endpoint URL from</span>\\nPROVIDER_ENDPOINT <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"https://mainnet.infura.io/v3/&lt;INFURA_PROJECT_ID>\\\"</span>\\n\\n<span class=\\\"token comment\\\"># Instantiate the Web3 class using the custom endpoint</span>\\nweb3 <span class=\\\"token operator\\\">=</span> Web3<span class=\\\"token punctuation\\\">(</span>Web3<span class=\\\"token punctuation\\\">.</span>HTTPProvider<span class=\\\"token punctuation\\\">(</span>PROVIDER_ENDPOINT<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Next, you’ll need to add your private key as a variable. Note <a href=\\\"https://web3py.readthedocs.io/en/stable/web3.eth.account.html\\\">there are many better ways to work with a local private key</a>; declaring it as a field in your code is probably the <em>worst</em> way, but this is a demo script and a demo wallet.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># NOT a good practice,</span>\\nPRIVATE_KEY <span class=\\\"token operator\\\">=</span> <span class=\\\"token string\\\">\\\"9bb913343e50eb6b52c64b021baa0413d19963177714931088b1559272b371ff\\\"</span>\\n</code></pre>\\n      </div>\\n<p>First, initialize the account using the private key. The private key can also be used to derive the public address of the wallet.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Use web3.eth.account library to derive the public address from the key.</span>\\n<span class=\\\"token comment\\\">#</span>\\n<span class=\\\"token comment\\\"># https://web3py.readthedocs.io/en/stable/web3.eth.account.html</span>\\nACCOUNT <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>account<span class=\\\"token punctuation\\\">.</span>privateKeyToAccount<span class=\\\"token punctuation\\\">(</span>PRIVATE_KEY<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Wallet address: {ACCOUNT.address}\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Next, retrieve the raw transaction JSON from the Django server, which will be running at <code>localhost</code>, using the same URL you used at the end of the last step. You’ll need to initialize the <code>urllib3</code> pool, fetch the JSON, and decode it to use it in the script:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># initialize the urllib3 pool manager</span>\\nhttp <span class=\\\"token operator\\\">=</span> urllib3<span class=\\\"token punctuation\\\">.</span>PoolManager<span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\n<span class=\\\"token comment\\\"># get and decode the raw transaction json</span>\\nraw_transaction_json <span class=\\\"token operator\\\">=</span> http<span class=\\\"token punctuation\\\">.</span>request<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'GET'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'http://localhost:8000/wallets/1/prepare_transaction/'</span><span class=\\\"token punctuation\\\">)</span>\\nraw_transaction <span class=\\\"token operator\\\">=</span> json<span class=\\\"token punctuation\\\">.</span>loads<span class=\\\"token punctuation\\\">(</span>raw_transaction_json<span class=\\\"token punctuation\\\">.</span>data<span class=\\\"token punctuation\\\">.</span>decode<span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'UTF-8'</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Raw Transaction: {raw_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>Try running the script from the command line using the new terminal window:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">python client<span class=\\\"token punctuation\\\">.</span>py\\n</code></pre>\\n      </div>\\n<p>You should see the same JSON as at the end of the previous step printed to the console.</p>\\n<p>Next, you’ll need to cryptographically sign the transaction with the account object:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\"><span class=\\\"token comment\\\"># Sign the raw transaction using the private key via the web3 acount object</span>\\nsigned_transaction <span class=\\\"token operator\\\">=</span> ACCOUNT<span class=\\\"token punctuation\\\">.</span>signTransaction<span class=\\\"token punctuation\\\">(</span>raw_transaction<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Signed Transaction: {signed_transaction}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<blockquote>\\n<p>The ColumbusToken contract contains a unique (and nonstandard) feature that allows an account to claim one CBUS token once upon request. This can actually be abused pretty easily, so it’s just a fun way to demonstrate interacting with a smart contract. See <a href=\\\"https://etherscan.io/address/0x07c344edd719a356775e1fbd852c63dc46167b76#code\\\">line 57 of the contract’s code</a> to see how this is implemented.</p>\\n</blockquote>\\n<p>Your signed transaction now contains everything it needs to be processed by the network. To get your CBUS Token, add the following line:</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-python\\\"><code class=\\\"language-python\\\">transaction_hash <span class=\\\"token operator\\\">=</span> web3<span class=\\\"token punctuation\\\">.</span>eth<span class=\\\"token punctuation\\\">.</span>sendRawTransaction<span class=\\\"token punctuation\\\">(</span>signed_transaction<span class=\\\"token punctuation\\\">.</span>rawTransaction<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">print</span><span class=\\\"token punctuation\\\">(</span>f<span class=\\\"token string\\\">\\\"Transaction Hash: {transaction_hash}\\\\n\\\"</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>At this point, running the script again using <code>python client.py</code> will execute the transaction add capture the token to the wallet. Keep in mind you can only do this once — subsequent runs will fail as the ColumbusToken can only be captured once per wallet!</p>\",\"tableOfContents\":\"<ul>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#accessing-the-wallet\\\">Accessing the Wallet</a></li>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#preparing-the-transaction\\\">Preparing the Transaction</a></li>\\n<li><a href=\\\"/django-meets-blockchain-site/part-2/instructions/#sign-and-execute-the-transaction\\\">Sign and Execute the Transaction</a></li>\\n</ul>\",\"excerpt\":\"Accessing the Wallet Before you begin, you’ll need to access your  infura.io  account — or sign up for one if you didn’t already. In Infura…\",\"frontmatter\":{\"id\":\"blockchain-instructions\",\"title\":\"Instructions\",\"prev\":\"blockchain-overview\",\"next\":null}}},\"pathContext\":{\"slug\":\"/part-2/instructions/\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/part-2-instructions.json\n// module id = 338\n// module chunks = 85560507404371"],"sourceRoot":""}